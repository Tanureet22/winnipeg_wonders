<!-- app/views/orders/new.html.erb -->
<h1>Checkout</h1>

<%= form_with model: @order, local: true do |f| %>
  <ul>
    <% @order.order_items.each do |item| %>
      <li>
        <%= item.product.name %> - <%= item.quantity %> x <%= item.unit_price %>
      </li>
    <% end %>
  </ul>
  <p>Total Amount: <%= number_to_currency calculate_total_amount(@order) %></p>
  <p>Tax Amount: <%= number_to_currency calculate_tax_amount(@order) %></p>
  <div id="payment-form">
    <%= hidden_field_tag :stripe_publishable_key, Rails.configuration.stripe[:publishable_key] %>
    <%= f.hidden_field :total_amount, value: calculate_total_amount(@order) %>
    <%= f.hidden_field :tax_amount, value: calculate_tax_amount(@order) %>
    <div class="form-row">
      <label for="card-element">Credit or debit card</label>
      <div id="card-element">
        <!-- A Stripe Element will be inserted here. -->
      </div>
      <!-- Used to display form errors. -->
      <div id="card-errors" role="alert"></div>
    </div>
    <%= f.submit 'Submit Payment' %>
  </div>
<% end %>
